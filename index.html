<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genius Tech - Ticketing System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }
        
        :root {
            --navy-900: #0f1419;
            --navy-800: #1a2332;
            --navy-700: #243447;
            --mint-500: #7dd3c0;
            --peach-500: #ffb4a2;
            --coral-500: #ff8b94;
            --sky-500: #6eb5ff;
        }
        
        body.light {
            --bg-primary: #fefbf7;
            --bg-secondary: #ffffff;
            --bg-sidebar: #ffffff;
            --text-primary: #1a2332;
            --text-secondary: #6b7280;
            --border-color: rgba(125, 211, 192, 0.2);
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        body.dark {
            --bg-primary: #0f1419;
            --bg-secondary: #1a2332;
            --bg-sidebar: #1a2332;
            --text-primary: #fefbf7;
            --text-secondary: #9ca3af;
            --border-color: rgba(125, 211, 192, 0.15);
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .sidebar {
            width: 280px;
            height: 100vh;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        
        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #7dd3c0 0%, #5a8ba0 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .logo-shape {
            position: absolute;
        }
        
        .logo-text {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 20px;
            color: var(--text-primary);
        }
        
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .sidebar-section {
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.5;
            margin-bottom: 8px;
            padding: 0 12px;
        }
        
        .nav-item {
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            position: relative;
            color: var(--text-primary);
        }
        
        .nav-item:hover {
            background: rgba(125, 211, 192, 0.1);
        }
        
        .nav-item.active {
            background: rgba(125, 211, 192, 0.15);
            font-weight: 600;
        }
        
        .nav-badge {
            margin-left: auto;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            background: var(--mint-500);
            color: white;
        }
        
        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid var(--border-color);
        }
        
        .user-card {
            padding: 12px;
            border-radius: 12px;
            background: rgba(125, 211, 192, 0.08);
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, #7dd3c0 0%, #5a8ba0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }
        
        .main-content {
            flex: 1;
            height: 100vh;
            overflow-y: auto;
            background: var(--bg-primary);
        }
        
        .content-wrapper {
            padding: 40px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .page-header {
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .page-title {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .glass-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 4px;
            color: var(--text-primary);
        }
        
        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #7dd3c0 0%, #5a8ba0 100%);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(125, 211, 192, 0.1);
            color: var(--mint-500);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff8b94 0%, #ff6b77 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffb4a2 0%, #ff9a84 100%);
            color: white;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }
        
        th {
            text-align: left;
            padding: 12px 16px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--mint-500);
        }
        
        td {
            padding: 16px;
            background: rgba(125, 211, 192, 0.04);
            color: var(--text-primary);
        }
        
        tbody tr {
            transition: all 0.2s;
        }
        
        tbody tr:hover td {
            background: rgba(125, 211, 192, 0.08);
        }
        
        td:first-child {
            border-radius: 12px 0 0 12px;
        }
        
        td:last-child {
            border-radius: 0 12px 12px 0;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--mint-500);
        }
        
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }
        
        .form-grid {
            display: grid;
            gap: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 32px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            display: inline-block;
        }
        
        .badge-high {
            background: linear-gradient(135deg, #ff8b94 0%, #ff6b77 100%);
            color: white;
        }
        
        .badge-medium {
            background: linear-gradient(135deg, #ffb4a2 0%, #ff9a84 100%);
            color: white;
        }
        
        .badge-low {
            background: linear-gradient(135deg, #7dd3c0 0%, #5a8ba0 100%);
            color: white;
        }
        
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            width: 100vw;
            padding: 20px;
            background: var(--bg-primary);
        }
        
        .login-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 48px;
            width: 100%;
            max-width: 450px;
        }
        
        .chart-container {
            height: 250px;
            margin-top: 20px;
        }
        
        .chart-bar {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            height: 200px;
        }
        
        .bar {
            flex: 1;
            background: linear-gradient(180deg, var(--mint-500) 0%, #5a8ba0 100%);
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .bar:hover {
            opacity: 0.8;
        }
        
        .bar-label {
            text-align: center;
            font-size: 11px;
            margin-top: 8px;
            color: var(--text-secondary);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--mint-500);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .invoice-sections {
            margin-top: 16px;
            padding: 16px;
            border: 2px dashed var(--border-color);
            border-radius: 12px;
        }
        
        .section-item {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
        }
        
        .section-item input {
            flex: 1;
        }
        
        .section-total {
            font-size: 18px;
            font-weight: 700;
            text-align: right;
            padding: 12px;
            margin-top: 12px;
            border-top: 2px solid var(--border-color);
            color: var(--peach-500);
        }
        
        .bulk-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding: 16px;
            background: rgba(125, 211, 192, 0.05);
            border-radius: 12px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        /*
         * GENIUS TECH TICKETING SYSTEM
         * CLIENT-READY VERSION - DATABASE INTEGRATION READY
         * 
         * DATABASE SCHEMA DOCUMENTATION
         * =============================
         * 
         * TABLES NEEDED:
         * 
         * 1. users
         *    - id (INT, PRIMARY KEY, AUTO_INCREMENT)
         *    - username (VARCHAR(50), UNIQUE, NOT NULL)
         *    - password (VARCHAR(255), HASHED, NOT NULL)
         *    - role (ENUM: 'owner', 'admin', 'staff')
         *    - firstName (VARCHAR(50))
         *    - lastName (VARCHAR(50))
         *    - name (VARCHAR(100), COMPUTED: firstName + lastName)
         *    - createdAt (TIMESTAMP)
         * 
         * 2. tickets
         *    - id (INT, PRIMARY KEY, AUTO_INCREMENT)
         *    - client (VARCHAR(100), NOT NULL)
         *    - task (TEXT, NOT NULL)
         *    - deadline (DATE, NOT NULL)
         *    - location (VARCHAR(100))
         *    - urgency (ENUM: 'low', 'medium', 'high')
         *    - assignedTo (INT, FOREIGN KEY → users.id)
         *    - description (TEXT)
         *    - created (TIMESTAMP, DEFAULT CURRENT_TIMESTAMP)
         *    - status (ENUM: 'active', 'completed', 'archived', 'deleted')
         *    - resolution (TEXT)
         *    - completedDate (TIMESTAMP)
         *    - archivedDate (TIMESTAMP)
         *    - deletedDate (TIMESTAMP)
         * 
         * 3. invoices
         *    - id (INT, PRIMARY KEY, AUTO_INCREMENT)
         *    - client (VARCHAR(100), NOT NULL)
         *    - paymentTerms (ENUM: 'now', 'end_of_month')
         *    - inQuickBooks (BOOLEAN, DEFAULT FALSE)
         *    - paymentDeadline (DATE)
         *    - contactName (VARCHAR(100))
         *    - contactEmail (VARCHAR(100))
         *    - contactPhone (VARCHAR(20))
         *    - totalAmount (DECIMAL(10,2), NOT NULL)
         *    - date (TIMESTAMP, DEFAULT CURRENT_TIMESTAMP)
         *    - paid (BOOLEAN, DEFAULT FALSE)
         *    - paidDate (TIMESTAMP)
         *    - status (ENUM: 'active', 'archived', 'deleted')
         *    - archivedDate (TIMESTAMP)
         *    - deletedDate (TIMESTAMP)
         * 
         * 4. invoice_sections
         *    - id (INT, PRIMARY KEY, AUTO_INCREMENT)
         *    - invoiceId (INT, FOREIGN KEY → invoices.id)
         *    - description (TEXT)
         *    - amount (DECIMAL(10,2))
         *    - sortOrder (INT)
         * 
         * API ENDPOINTS NEEDED:
         * ====================
         * 
         * Authentication:
         * POST   /api/auth/login          - Login user
         * POST   /api/auth/logout         - Logout user
         * GET    /api/auth/session        - Get current session
         * 
         * Users:
         * GET    /api/users               - Get all users (admin only)
         * POST   /api/users               - Create user (admin only)
         * PUT    /api/users/:id           - Update user
         * DELETE /api/users/:id           - Delete user (owner only)
         * 
         * Tickets:
         * GET    /api/tickets             - Get all tickets (filtered by user role)
         * GET    /api/tickets/my          - Get my assigned tickets
         * GET    /api/tickets/overdue     - Get overdue tickets
         * GET    /api/tickets/completed   - Get completed tickets
         * GET    /api/tickets/archived    - Get archived tickets
         * POST   /api/tickets             - Create ticket
         * PUT    /api/tickets/:id         - Update ticket
         * PUT    /api/tickets/:id/complete - Complete ticket
         * PUT    /api/tickets/:id/archive  - Archive ticket
         * PUT    /api/tickets/:id/unarchive - Unarchive ticket
         * DELETE /api/tickets/:id         - Soft delete ticket
         * DELETE /api/tickets/:id/permanent - Permanent delete
         * 
         * Invoices:
         * GET    /api/invoices            - Get all invoices
         * GET    /api/invoices/paid       - Get paid invoices
         * GET    /api/invoices/archived   - Get archived invoices
         * POST   /api/invoices            - Create invoice (with sections)
         * PUT    /api/invoices/:id        - Update invoice
         * PUT    /api/invoices/:id/pay    - Mark invoice as paid
         * PUT    /api/invoices/:id/archive - Archive invoice
         * PUT    /api/invoices/:id/unarchive - Unarchive invoice
         * DELETE /api/invoices/:id        - Soft delete invoice
         * DELETE /api/invoices/:id/permanent - Permanent delete
         * 
         * Recycle Bin:
         * GET    /api/recycle             - Get deleted items
         * DELETE /api/recycle/:id         - Permanent delete
         * DELETE /api/recycle             - Empty recycle bin
         * 
         * Analytics:
         * GET    /api/analytics/tickets   - Get ticket statistics
         * GET    /api/analytics/revenue   - Get revenue statistics
         * GET    /api/analytics/monthly   - Get monthly data for charts
         * 
         * SECURITY NOTES:
         * ==============
         * - Use bcrypt for password hashing
         * - Implement JWT tokens for authentication
         * - Add rate limiting on API endpoints
         * - Validate all inputs server-side
         * - Use HTTPS in production
         * - Implement CORS properly
         * - Add SQL injection protection (use parameterized queries)
         * - Implement role-based access control (RBAC)
         */
        
        const { useState, useEffect, useMemo } = React;
        
        const Icon = ({ name, size = 20 }) => {
            const icons = {
                dashboard: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>`,
                ticket: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>`,
                user: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
                users: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>`,
                invoice: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>`,
                alert: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`,
                check: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>`,
                calendar: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>`,
                archive: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/><line x1="10" y1="12" x2="14" y2="12"/></svg>`,
                trash: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>`,
                settings: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m0 2.83l-4.24 4.24M23 12h-6m-6 0H1m18.66 5.66l-4.24-4.24m-2.83 0l-4.24 4.24"/></svg>`,
                logout: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>`,
                plus: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`,
                x: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,
                moon: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>`,
                sun: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>`,
                dollar: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>`,
                clock: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`,
                search: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>`,
                edit: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`,
            };
            return <span dangerouslySetInnerHTML={{ __html: icons[name] || icons.dashboard }} />;
        };
        
        const App = () => {
            const getSystemTheme = () => {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    return true;
                }
                return false;
            };
            
            const [darkMode, setDarkMode] = useState(getSystemTheme());
            const [currentUser, setCurrentUser] = useState(null);
            const [currentView, setCurrentView] = useState('dashboard');
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            
            useEffect(() => {
                document.body.className = darkMode ? 'dark' : 'light';
            }, [darkMode]);
            
            useEffect(() => {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                const handleChange = (e) => setDarkMode(e.matches);
                mediaQuery.addEventListener('change', handleChange);
                return () => mediaQuery.removeEventListener('change', handleChange);
            }, []);
            
            const [users, setUsers] = useState([
                { id: 1, username: 'owner', password: 'owner123', role: 'owner', name: 'System Owner', firstName: 'System', lastName: 'Owner' },
                { id: 2, username: 'admin', password: 'admin123', role: 'admin', name: 'Admin User', firstName: 'Admin', lastName: 'User' },
                { id: 3, username: 'john', password: 'john123', role: 'staff', name: 'John Smith', firstName: 'John', lastName: 'Smith' }
            ]);
            
            const [tickets, setTickets] = useState([]);
            const [completedTickets, setCompletedTickets] = useState([]);
            const [archivedTickets, setArchivedTickets] = useState([]);
            const [invoices, setInvoices] = useState([]);
            const [archivedInvoices, setArchivedInvoices] = useState([]);
            const [recycleBin, setRecycleBin] = useState([]);
            
            const [selectedTickets, setSelectedTickets] = useState([]);
            const [selectedInvoices, setSelectedInvoices] = useState([]);
            
            const [ticketSearch, setTicketSearch] = useState('');
            const [invoiceSearch, setInvoiceSearch] = useState('');
            
            const [showNewTicket, setShowNewTicket] = useState(false);
            const [showNewInvoice, setShowNewInvoice] = useState(false);
            const [showResolution, setShowResolution] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [showAddStaff, setShowAddStaff] = useState(false);
            const [showEditUser, setShowEditUser] = useState(false);
            const [editingUser, setEditingUser] = useState(null);
            const [showTicketDetail, setShowTicketDetail] = useState(false);
            const [showInvoiceDetail, setShowInvoiceDetail] = useState(false);
            const [viewingTicket, setViewingTicket] = useState(null);
            const [viewingInvoice, setViewingInvoice] = useState(null);
            const [showEditTicket, setShowEditTicket] = useState(false);
            const [editingTicket, setEditingTicket] = useState(null);
            const [editTicketForm, setEditTicketForm] = useState({
                client: '', task: '', deadline: '', location: '', urgency: 'medium', assignedTo: '', description: ''
            });
            
            const [newTicket, setNewTicket] = useState({
                client: '', task: '', deadline: '', location: '', urgency: 'medium', assignedTo: '', description: ''
            });
            
            const [invoiceSections, setInvoiceSections] = useState([{ description: '', type: 'hourly', rate: '', hours: '', amount: '' }]);
            const [newInvoice, setNewInvoice] = useState({
                client: '', paymentTerms: 'now', inQuickBooks: 'no', paymentDeadline: '', contactName: '', contactEmail: '', contactPhone: ''
            });
            
            const [selectedTicket, setSelectedTicket] = useState(null);
            const [resolution, setResolution] = useState('');
            
            const [newStaff, setNewStaff] = useState({
                username: '', password: '', firstName: '', lastName: '', role: 'staff'
            });
            
            const [editUserForm, setEditUserForm] = useState({
                username: '', password: '', confirmPassword: ''
            });
            
            const [settingsForm, setSettingsForm] = useState({
                currentPassword: '', newUsername: '', newPassword: '', confirmPassword: ''
            });
            
            const stats = useMemo(() => ({
                openTickets: tickets.length,
                myTickets: tickets.filter(t => t.assignedTo === currentUser?.username).length,
                overdueTickets: tickets.filter(t => new Date(t.deadline) < new Date()).length,
                revenue: invoices.filter(inv => inv.paid).reduce((sum, inv) => sum + parseFloat(inv.totalAmount || 0), 0)
            }), [tickets, invoices, currentUser]);
            
            const chartData = useMemo(() => {
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const currentYear = new Date().getFullYear();
                return months.map((month, idx) => ({
                    month,
                    tickets: [...tickets, ...completedTickets].filter(t => {
                        if (!t.created) return false;
                        const date = new Date(t.created);
                        return date.getMonth() === idx && date.getFullYear() === currentYear;
                    }).length,
                    revenue: invoices.filter(inv => {
                        if (!inv.paid || !inv.paidDate) return false;
                        const date = new Date(inv.paidDate);
                        return date.getMonth() === idx && date.getFullYear() === currentYear;
                    }).reduce((sum, inv) => sum + parseFloat(inv.totalAmount || 0), 0)
                }));
            }, [tickets, completedTickets, invoices]);
            
            const maxTickets = Math.max(...chartData.map(d => d.tickets), 1);
            const maxRevenue = Math.max(...chartData.map(d => d.revenue), 1);
            
            const filteredTickets = useMemo(() => {
                return tickets.filter(t =>
                    t.client.toLowerCase().includes(ticketSearch.toLowerCase()) ||
                    t.task.toLowerCase().includes(ticketSearch.toLowerCase())
                );
            }, [tickets, ticketSearch]);
            
            const filteredInvoices = useMemo(() => {
                return invoices.filter(inv =>
                    !inv.paid && inv.client.toLowerCase().includes(invoiceSearch.toLowerCase())
                );
            }, [invoices, invoiceSearch]);
            
            const myTickets = useMemo(() => {
                return tickets.filter(t => t.assignedTo === currentUser?.username);
            }, [tickets, currentUser]);
            
            const overdueTickets = useMemo(() => {
                return tickets.filter(t => new Date(t.deadline) < new Date());
            }, [tickets]);
            
            const paidInvoices = useMemo(() => {
                return invoices.filter(inv => 
                    inv.paid && inv.client.toLowerCase().includes(invoiceSearch.toLowerCase())
                );
            }, [invoices, invoiceSearch]);
            
            const handleLogin = (e) => {
                e.preventDefault();
                const user = users.find(u => 
                    u.username === loginForm.username && u.password === loginForm.password
                );
                if (user) {
                    setCurrentUser(user);
                } else {
                    alert('Invalid credentials');
                }
            };
            
            const toggleTicketSelection = (id) => {
                setSelectedTickets(prev => 
                    prev.includes(id) ? prev.filter(tid => tid !== id) : [...prev, id]
                );
            };
            
            const toggleInvoiceSelection = (id) => {
                setSelectedInvoices(prev => 
                    prev.includes(id) ? prev.filter(iid => iid !== id) : [...prev, id]
                );
            };
            
            const bulkArchiveTickets = () => {
                if (selectedTickets.length === 0) return;
                const toArchive = tickets.filter(t => selectedTickets.includes(t.id));
                setArchivedTickets(prev => [...prev, ...toArchive.map(t => ({
                    ...t,
                    archivedDate: new Date().toISOString().split('T')[0]
                }))]);
                setTickets(prev => prev.filter(t => !selectedTickets.includes(t.id)));
                setSelectedTickets([]);
            };
            
            const bulkDeleteTickets = () => {
                if (selectedTickets.length === 0) return;
                if (!confirm(`Delete ${selectedTickets.length} ticket(s)?`)) return;
                const toDelete = tickets.filter(t => selectedTickets.includes(t.id));
                setRecycleBin(prev => [...prev, ...toDelete.map(t => ({
                    ...t,
                    type: 'ticket',
                    deletedDate: new Date().toISOString().split('T')[0]
                }))]);
                setTickets(prev => prev.filter(t => !selectedTickets.includes(t.id)));
                setSelectedTickets([]);
            };
            
            const bulkArchiveInvoices = () => {
                if (selectedInvoices.length === 0) return;
                const toArchive = invoices.filter(inv => selectedInvoices.includes(inv.id));
                setArchivedInvoices(prev => [...prev, ...toArchive.map(inv => ({
                    ...inv,
                    archivedDate: new Date().toISOString().split('T')[0]
                }))]);
                setInvoices(prev => prev.filter(inv => !selectedInvoices.includes(inv.id)));
                setSelectedInvoices([]);
            };
            
            const bulkDeleteInvoices = () => {
                if (selectedInvoices.length === 0) return;
                if (!confirm(`Delete ${selectedInvoices.length} invoice(s)?`)) return;
                const toDelete = invoices.filter(inv => selectedInvoices.includes(inv.id));
                setRecycleBin(prev => [...prev, ...toDelete.map(inv => ({
                    ...inv,
                    type: 'invoice',
                    deletedDate: new Date().toISOString().split('T')[0]
                }))]);
                setInvoices(prev => prev.filter(inv => !selectedInvoices.includes(inv.id)));
                setSelectedInvoices([]);
            };
            
            const createTicket = () => {
                if (newTicket.client && newTicket.task && newTicket.deadline) {
                    setTickets(prev => [...prev, {
                        ...newTicket,
                        id: Date.now(),
                        created: new Date().toISOString().split('T')[0]
                    }]);
                    setNewTicket({ client: '', task: '', deadline: '', location: '', urgency: 'medium', assignedTo: '', description: '' });
                    setShowNewTicket(false);
                }
            };
            
            const openEditTicket = (ticket) => {
                setEditingTicket(ticket);
                setEditTicketForm({
                    client: ticket.client,
                    task: ticket.task,
                    deadline: ticket.deadline,
                    location: ticket.location || '',
                    urgency: ticket.urgency,
                    assignedTo: ticket.assignedTo || '',
                    description: ticket.description || ''
                });
                setShowEditTicket(true);
            };
            
            const updateTicket = () => {
                if (editTicketForm.client && editTicketForm.task && editTicketForm.deadline) {
                    setTickets(prev => prev.map(t => 
                        t.id === editingTicket.id ? { ...t, ...editTicketForm } : t
                    ));
                    setShowEditTicket(false);
                    setEditingTicket(null);
                    setEditTicketForm({ client: '', task: '', deadline: '', location: '', urgency: 'medium', assignedTo: '', description: '' });
                }
            };
            
            const completeTicket = () => {
                if (selectedTicket && resolution.trim()) {
                    setCompletedTickets(prev => [...prev, {
                        ...selectedTicket,
                        resolution,
                        completedDate: new Date().toISOString().split('T')[0]
                    }]);
                    setTickets(prev => prev.filter(t => t.id !== selectedTicket.id));
                    setSelectedTicket(null);
                    setResolution('');
                    setShowResolution(false);
                }
            };
            
            const archiveTicket = (ticket, fromCompleted = false) => {
                setArchivedTickets(prev => [...prev, { ...ticket, archivedDate: new Date().toISOString().split('T')[0] }]);
                if (fromCompleted) {
                    setCompletedTickets(prev => prev.filter(t => t.id !== ticket.id));
                } else {
                    setTickets(prev => prev.filter(t => t.id !== ticket.id));
                }
            };
            
            const unarchiveTicket = (ticket) => {
                if (ticket.completedDate) {
                    // Was completed, restore to completed
                    const restored = { ...ticket };
                    delete restored.archivedDate;
                    setCompletedTickets(prev => [...prev, restored]);
                } else {
                    // Was active, restore to active
                    const restored = { ...ticket };
                    delete restored.archivedDate;
                    setTickets(prev => [...prev, restored]);
                }
                setArchivedTickets(prev => prev.filter(t => t.id !== ticket.id));
            };
            
            const deleteTicket = (ticket) => {
                if (confirm('Move to recycle bin?')) {
                    setRecycleBin(prev => [...prev, { ...ticket, type: 'ticket', deletedDate: new Date().toISOString().split('T')[0] }]);
                    setTickets(prev => prev.filter(t => t.id !== ticket.id));
                }
            };
            
            const addInvoiceSection = () => {
                setInvoiceSections([...invoiceSections, { description: '', type: 'hourly', rate: '', hours: '', amount: '' }]);
            };
            
            const removeInvoiceSection = (index) => {
                setInvoiceSections(invoiceSections.filter((_, i) => i !== index));
            };
            
            const updateInvoiceSection = (index, field, value) => {
                const updated = [...invoiceSections];
                updated[index][field] = value;
                setInvoiceSections(updated);
            };
            
            const calculateInvoiceTotal = () => {
                return invoiceSections.reduce((sum, section) => {
                    if (section.type === 'hourly') {
                        const rate = parseFloat(section.rate) || 0;
                        const hours = parseFloat(section.hours) || 0;
                        return sum + (rate * hours);
                    } else {
                        return sum + (parseFloat(section.amount) || 0);
                    }
                }, 0);
            };
            
            const createInvoice = () => {
                const total = calculateInvoiceTotal();
                if (newInvoice.client && total > 0) {
                    setInvoices(prev => [...prev, {
                        ...newInvoice,
                        sections: invoiceSections,
                        totalAmount: total,
                        id: Date.now(),
                        date: new Date().toISOString().split('T')[0],
                        paid: false,
                        paidDate: null
                    }]);
                    setNewInvoice({ client: '', paymentTerms: 'now', inQuickBooks: 'no', paymentDeadline: '', contactName: '', contactEmail: '', contactPhone: '' });
                    setInvoiceSections([{ description: '', type: 'hourly', rate: '', hours: '', amount: '' }]);
                    setShowNewInvoice(false);
                } else {
                    alert('Please add client name and at least one section with valid amount');
                }
            };
            
            const togglePaid = (id) => {
                setInvoices(prev => prev.map(inv =>
                    inv.id === id ? { 
                        ...inv, 
                        paid: !inv.paid,
                        paidDate: !inv.paid ? new Date().toISOString().split('T')[0] : null
                    } : inv
                ));
            };
            
            const archiveInvoice = (invoice) => {
                setArchivedInvoices(prev => [...prev, { ...invoice, archivedDate: new Date().toISOString().split('T')[0] }]);
                setInvoices(prev => prev.filter(inv => inv.id !== invoice.id));
            };
            
            const unarchiveInvoice = (invoice) => {
                const restored = { ...invoice };
                delete restored.archivedDate;
                setInvoices(prev => [...prev, restored]);
                setArchivedInvoices(prev => prev.filter(inv => inv.id !== invoice.id));
            };
            
            const deleteInvoice = (invoice) => {
                if (confirm('Move to recycle bin?')) {
                    setRecycleBin(prev => [...prev, { ...invoice, type: 'invoice', deletedDate: new Date().toISOString().split('T')[0] }]);
                    setInvoices(prev => prev.filter(inv => inv.id !== invoice.id));
                }
            };
            
            const addStaff = () => {
                if (newStaff.username && newStaff.password && newStaff.firstName && newStaff.lastName) {
                    setUsers(prev => [...prev, {
                        ...newStaff,
                        id: Date.now(),
                        name: `${newStaff.firstName} ${newStaff.lastName}`
                    }]);
                    setNewStaff({ username: '', password: '', firstName: '', lastName: '', role: 'staff' });
                    setShowAddStaff(false);
                }
            };
            
            const removeStaff = (userId) => {
                if (confirm('Remove this staff member?')) {
                    setUsers(prev => prev.filter(u => u.id !== userId));
                }
            };
            
            const openEditUser = (user) => {
                setEditingUser(user);
                setEditUserForm({
                    username: user.username,
                    password: '',
                    confirmPassword: ''
                });
                setShowEditUser(true);
            };
            
            const updateUser = () => {
                if (editUserForm.password && editUserForm.password !== editUserForm.confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }
                
                const updates = {
                    username: editUserForm.username
                };
                
                if (editUserForm.password) {
                    updates.password = editUserForm.password;
                }
                
                setUsers(prev => prev.map(u => 
                    u.id === editingUser.id ? { ...u, ...updates } : u
                ));
                
                if (currentUser.id === editingUser.id) {
                    setCurrentUser({ ...currentUser, ...updates });
                }
                
                setShowEditUser(false);
                setEditingUser(null);
                setEditUserForm({ username: '', password: '', confirmPassword: '' });
                alert('User updated successfully!');
            };
            
            const updateSettings = () => {
                if (settingsForm.currentPassword === currentUser.password) {
                    const updates = {};
                    if (settingsForm.newUsername) updates.username = settingsForm.newUsername;
                    if (settingsForm.newPassword && settingsForm.newPassword === settingsForm.confirmPassword) {
                        updates.password = settingsForm.newPassword;
                    }
                    
                    const updated = { ...currentUser, ...updates };
                    setUsers(prev => prev.map(u => u.id === currentUser.id ? updated : u));
                    setCurrentUser(updated);
                    setShowSettings(false);
                    setSettingsForm({ currentPassword: '', newUsername: '', newPassword: '', confirmPassword: '' });
                    alert('Settings updated successfully!');
                } else {
                    alert('Current password is incorrect');
                }
            };
            
            const getStaffName = (username) => {
                const user = users.find(u => u.username === username);
                return user ? user.name : 'Unassigned';
            };
            
            if (!currentUser) {
                return (
                    <div className="login-screen">
                        <div className="login-card">
                            <div style={{ textAlign: 'center', marginBottom: '32px' }}>
                                <div className="logo-icon" style={{ width: '80px', height: '80px', margin: '0 auto 20px' }}>
                                    <div className="logo-shape" style={{ width: '24px', height: '24px', background: 'white', borderRadius: '4px', transform: 'rotate(45deg)' }}></div>
                                    <div className="logo-shape" style={{ width: '16px', height: '16px', background: 'rgba(255,255,255,0.7)', borderRadius: '50%', position: 'absolute', top: '8px', right: '8px' }}></div>
                                </div>
                                <h1 className="logo-text" style={{ fontSize: '32px', marginBottom: '8px' }}>Genius Tech</h1>
                                <p style={{ color: 'var(--text-secondary)' }}>Ticketing System</p>
                            </div>
                            
                            <form onSubmit={handleLogin}>
                                <div style={{ marginBottom: '20px' }}>
                                    <label className="form-label">Username</label>
                                    <input
                                        type="text"
                                        value={loginForm.username}
                                        onChange={(e) => setLoginForm({ ...loginForm, username: e.target.value })}
                                        required
                                    />
                                </div>
                                
                                <div style={{ marginBottom: '24px' }}>
                                    <label className="form-label">Password</label>
                                    <input
                                        type="password"
                                        value={loginForm.password}
                                        onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}
                                        required
                                    />
                                </div>
                                
                                <button type="submit" className="btn btn-primary" style={{ width: '100%', justifyContent: 'center' }}>
                                    Sign In
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="app-container">
                    <div className="sidebar">
                        <div className="sidebar-header">
                            <div className="logo">
                                <div className="logo-icon">
                                    <div className="logo-shape" style={{ width: '16px', height: '16px', background: 'white', borderRadius: '3px', transform: 'rotate(45deg)' }}></div>
                                    <div className="logo-shape" style={{ width: '10px', height: '10px', background: 'rgba(255,255,255,0.7)', borderRadius: '50%', position: 'absolute', top: '6px', right: '6px' }}></div>
                                </div>
                                <span className="logo-text">Genius Tech</span>
                            </div>
                        </div>
                        
                        <div className="sidebar-content">
                            <div className="sidebar-section">
                                <div className="section-title">Overview</div>
                                <div className={`nav-item ${currentView === 'dashboard' ? 'active' : ''}`} onClick={() => setCurrentView('dashboard')}>
                                    <Icon name="dashboard" />
                                    Dashboard
                                </div>
                            </div>
                            
                            <div className="sidebar-section">
                                <div className="section-title">Tickets</div>
                                <div className={`nav-item ${currentView === 'tickets' ? 'active' : ''}`} onClick={() => setCurrentView('tickets')}>
                                    <Icon name="ticket" />
                                    Active Tickets
                                    {tickets.length > 0 && <span className="nav-badge">{tickets.length}</span>}
                                </div>
                                <div className={`nav-item ${currentView === 'my-tickets' ? 'active' : ''}`} onClick={() => setCurrentView('my-tickets')}>
                                    <Icon name="user" />
                                    My Tickets
                                    {myTickets.length > 0 && <span className="nav-badge">{myTickets.length}</span>}
                                </div>
                                <div className={`nav-item ${currentView === 'overdue' ? 'active' : ''}`} onClick={() => setCurrentView('overdue')}>
                                    <Icon name="alert" />
                                    Overdue
                                    {overdueTickets.length > 0 && <span className="nav-badge">{overdueTickets.length}</span>}
                                </div>
                                <div className={`nav-item ${currentView === 'completed' ? 'active' : ''}`} onClick={() => setCurrentView('completed')}>
                                    <Icon name="check" />
                                    Completed
                                    {completedTickets.length > 0 && <span className="nav-badge">{completedTickets.length}</span>}
                                </div>
                                <div className={`nav-item ${currentView === 'archived-tickets' ? 'active' : ''}`} onClick={() => setCurrentView('archived-tickets')}>
                                    <Icon name="archive" />
                                    Archived
                                    {archivedTickets.length > 0 && <span className="nav-badge">{archivedTickets.length}</span>}
                                </div>
                            </div>
                            
                            <div className="sidebar-section">
                                <div className="section-title">Financial</div>
                                <div className={`nav-item ${currentView === 'invoices' ? 'active' : ''}`} onClick={() => setCurrentView('invoices')}>
                                    <Icon name="invoice" />
                                    Invoices
                                    {invoices.filter(inv => !inv.paid).length > 0 && <span className="nav-badge">{invoices.filter(inv => !inv.paid).length}</span>}
                                </div>
                                <div className={`nav-item ${currentView === 'paid' ? 'active' : ''}`} onClick={() => setCurrentView('paid')}>
                                    <Icon name="check" />
                                    Paid
                                    {paidInvoices.length > 0 && <span className="nav-badge">{paidInvoices.length}</span>}
                                </div>
                                <div className={`nav-item ${currentView === 'archived-invoices' ? 'active' : ''}`} onClick={() => setCurrentView('archived-invoices')}>
                                    <Icon name="archive" />
                                    Archived
                                    {archivedInvoices.length > 0 && <span className="nav-badge">{archivedInvoices.length}</span>}
                                </div>
                            </div>
                            
                            <div className="sidebar-section">
                                <div className="section-title">System</div>
                                <div className={`nav-item ${currentView === 'recycle' ? 'active' : ''}`} onClick={() => setCurrentView('recycle')}>
                                    <Icon name="trash" />
                                    Recycle Bin
                                    {recycleBin.length > 0 && <span className="nav-badge">{recycleBin.length}</span>}
                                </div>
                                {(currentUser.role === 'owner' || currentUser.role === 'admin') && (
                                    <div className={`nav-item ${currentView === 'admin' ? 'active' : ''}`} onClick={() => setCurrentView('admin')}>
                                        <Icon name="users" />
                                        Admin Panel
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        <div className="sidebar-footer">
                            <div className="user-card">
                                <div className="user-avatar">
                                    {currentUser.firstName?.[0] || currentUser.name[0]}
                                </div>
                                <div style={{ flex: 1, minWidth: 0 }}>
                                    <div style={{ fontWeight: 600, fontSize: '14px', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>
                                        {currentUser.name}
                                    </div>
                                    <div style={{ fontSize: '11px', color: 'var(--text-secondary)', textTransform: 'uppercase' }}>
                                        {currentUser.role}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="nav-item" onClick={() => setShowSettings(true)}>
                                <Icon name="settings" />
                                Settings
                            </div>
                            
                            <div className="nav-item" onClick={() => setDarkMode(!darkMode)}>
                                <Icon name={darkMode ? 'sun' : 'moon'} />
                                {darkMode ? 'Light' : 'Dark'} Mode
                            </div>
                            
                            <div className="nav-item" onClick={() => setCurrentUser(null)} style={{ color: 'var(--coral-500)' }}>
                                <Icon name="logout" />
                                Logout
                            </div>
                        </div>
                    </div>
                    
                    <div className="main-content">
                        {currentView === 'dashboard' && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <div>
                                        <h1 className="page-title">Dashboard</h1>
                                        <p className="page-subtitle">Welcome back, {currentUser.firstName || currentUser.name}</p>
                                    </div>
                                </div>
                                
                                <div className="stats-grid">
                                    <div className="stat-card">
                                        <div className="stat-icon" style={{ background: 'linear-gradient(135deg, #7dd3c0 0%, #5a8ba0 100%)' }}>
                                            <Icon name="ticket" />
                                        </div>
                                        <div>
                                            <div className="stat-value">{stats.openTickets}</div>
                                            <div className="stat-label">Open Tickets</div>
                                        </div>
                                    </div>
                                    
                                    <div className="stat-card">
                                        <div className="stat-icon" style={{ background: 'linear-gradient(135deg, #7dd3c0 0%, #5a8ba0 100%)' }}>
                                            <Icon name="user" />
                                        </div>
                                        <div>
                                            <div className="stat-value">{stats.myTickets}</div>
                                            <div className="stat-label">My Tickets</div>
                                        </div>
                                    </div>
                                    
                                    <div className="stat-card">
                                        <div className="stat-icon" style={{ background: 'linear-gradient(135deg, #ffb4a2 0%, #ff8b94 100%)' }}>
                                            <Icon name="dollar" />
                                        </div>
                                        <div>
                                            <div className="stat-value">£{stats.revenue.toFixed(0)}</div>
                                            <div className="stat-label">Revenue</div>
                                        </div>
                                    </div>
                                    
                                    <div className="stat-card">
                                        <div className="stat-icon" style={{ background: 'linear-gradient(135deg, #ff8b94 0%, #ff6b77 100%)' }}>
                                            <Icon name="alert" />
                                        </div>
                                        <div>
                                            <div className="stat-value">{stats.overdueTickets}</div>
                                            <div className="stat-label">Overdue</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="glass-card" style={{ marginBottom: '20px' }}>
                                    <h3 style={{ fontSize: '18px', fontWeight: '700', marginBottom: '4px' }}>Monthly Ticket Activity</h3>
                                    <p style={{ fontSize: '12px', color: 'var(--text-secondary)', marginBottom: '20px' }}>Tickets created this year</p>
                                    <div className="chart-container">
                                        <div className="chart-bar">
                                            {chartData.map((data, idx) => (
                                                <div key={idx} style={{ flex: 1, textAlign: 'center' }}>
                                                    <div 
                                                        className="bar" 
                                                        style={{ height: `${maxTickets > 0 ? (data.tickets / maxTickets) * 100 : 0}%`, minHeight: data.tickets > 0 ? '10px' : '0' }}
                                                        title={`${data.month}: ${data.tickets} tickets`}
                                                    ></div>
                                                    <div className="bar-label">{data.month}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="glass-card">
                                    <h3 style={{ fontSize: '18px', fontWeight: '700', marginBottom: '4px' }}>Monthly Revenue</h3>
                                    <p style={{ fontSize: '12px', color: 'var(--text-secondary)', marginBottom: '20px' }}>Revenue from paid invoices this year</p>
                                    <div className="chart-container">
                                        <div className="chart-bar">
                                            {chartData.map((data, idx) => (
                                                <div key={idx} style={{ flex: 1, textAlign: 'center' }}>
                                                    <div 
                                                        className="bar" 
                                                        style={{ 
                                                            height: `${maxRevenue > 0 ? (data.revenue / maxRevenue) * 100 : 0}%`,
                                                            minHeight: data.revenue > 0 ? '10px' : '0',
                                                            background: 'linear-gradient(180deg, #ffb4a2 0%, #ff8b94 100%)'
                                                        }}
                                                        title={`${data.month}: £${data.revenue.toFixed(2)}`}
                                                    ></div>
                                                    <div className="bar-label">{data.month}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'tickets' && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <div>
                                        <h1 className="page-title">Active Tickets</h1>
                                        <p className="page-subtitle">Manage all active support tickets</p>
                                    </div>
                                    <button className="btn btn-primary" onClick={() => setShowNewTicket(true)}>
                                        <Icon name="plus" />
                                        New Ticket
                                    </button>
                                </div>
                                
                                {selectedTickets.length > 0 && (
                                    <div className="bulk-actions">
                                        <span style={{ fontWeight: 600 }}>{selectedTickets.length} selected</span>
                                        <button className="btn btn-sm btn-warning" onClick={bulkArchiveTickets}>
                                            <Icon name="archive" size={16} />
                                            Archive Selected
                                        </button>
                                        <button className="btn btn-sm btn-danger" onClick={bulkDeleteTickets}>
                                            <Icon name="trash" size={16} />
                                            Delete Selected
                                        </button>
                                    </div>
                                )}
                                
                                <div className="glass-card">
                                    {tickets.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon"><Icon name="ticket" size={48} /></div>
                                            <p>No active tickets yet</p>
                                            <button className="btn btn-primary" onClick={() => setShowNewTicket(true)} style={{ marginTop: '16px' }}>
                                                <Icon name="plus" />
                                                Create First Ticket
                                            </button>
                                        </div>
                                    ) : (
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th style={{ width: '40px' }}>
                                                        <input 
                                                            type="checkbox"
                                                            checked={selectedTickets.length === tickets.length && tickets.length > 0}
                                                            onChange={(e) => {
                                                                if (e.target.checked) {
                                                                    setSelectedTickets(tickets.map(t => t.id));
                                                                } else {
                                                                    setSelectedTickets([]);
                                                                }
                                                            }}
                                                        />
                                                    </th>
                                                    <th>Client</th>
                                                    <th>Task</th>
                                                    <th>Deadline</th>
                                                    <th>Urgency</th>
                                                    <th>Assigned To</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {filteredTickets.map(ticket => (
                                                    <tr key={ticket.id}>
                                                        <td>
                                                            <input 
                                                                type="checkbox"
                                                                checked={selectedTickets.includes(ticket.id)}
                                                                onChange={() => toggleTicketSelection(ticket.id)}
                                                            />
                                                        </td>
                                                        <td style={{ fontWeight: 600 }}>{ticket.client}</td>
                                                        <td>{ticket.task}</td>
                                                        <td>{ticket.deadline}</td>
                                                        <td>
                                                            <span className={`badge badge-${ticket.urgency}`}>
                                                                {ticket.urgency}
                                                            </span>
                                                        </td>
                                                        <td>{getStaffName(ticket.assignedTo)}</td>
                                                        <td>
                                                            <div style={{ display: 'flex', gap: '8px' }}>
                                                                <button className="btn btn-sm btn-secondary" onClick={() => { setViewingTicket(ticket); setShowTicketDetail(true); }}>
                                                                    <Icon name="search" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-secondary" onClick={() => openEditTicket(ticket)}>
                                                                    <Icon name="edit" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-primary" onClick={() => { setSelectedTicket(ticket); setShowResolution(true); }}>
                                                                    <Icon name="check" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-warning" onClick={() => archiveTicket(ticket, false)}>
                                                                    <Icon name="archive" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-danger" onClick={() => deleteTicket(ticket)}>
                                                                    <Icon name="trash" size={16} />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'overdue' && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <h1 className="page-title">Overdue Tickets</h1>
                                    <p className="page-subtitle">Tickets past their deadline</p>
                                </div>
                                
                                <div className="glass-card">
                                    {overdueTickets.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon"><Icon name="check" size={48} /></div>
                                            <p>No overdue tickets!</p>
                                        </div>
                                    ) : (
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Client</th>
                                                    <th>Task</th>
                                                    <th>Deadline</th>
                                                    <th>Days Overdue</th>
                                                    <th>Assigned To</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {overdueTickets.map(ticket => {
                                                    const daysOverdue = Math.floor((new Date() - new Date(ticket.deadline)) / (1000 * 60 * 60 * 24));
                                                    return (
                                                        <tr key={ticket.id}>
                                                            <td style={{ fontWeight: 600 }}>{ticket.client}</td>
                                                            <td>{ticket.task}</td>
                                                            <td style={{ color: 'var(--coral-500)' }}>{ticket.deadline}</td>
                                                            <td>
                                                                <span className="badge badge-high">
                                                                    {daysOverdue} {daysOverdue === 1 ? 'day' : 'days'}
                                                                </span>
                                                            </td>
                                                            <td>{getStaffName(ticket.assignedTo)}</td>
                                                            <td>
                                                                <div style={{ display: 'flex', gap: '8px' }}>
                                                                    <button className="btn btn-sm btn-secondary" onClick={() => { setViewingTicket(ticket); setShowTicketDetail(true); }}>
                                                                        <Icon name="search" size={16} />
                                                                    </button>
                                                                    <button className="btn btn-sm btn-primary" onClick={() => { setSelectedTicket(ticket); setShowResolution(true); }}>
                                                                        <Icon name="check" size={16} />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'completed' && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <h1 className="page-title">Completed Tickets</h1>
                                    <p className="page-subtitle">Successfully resolved tickets</p>
                                </div>
                                
                                <div className="glass-card">
                                    {completedTickets.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon"><Icon name="check" size={48} /></div>
                                            <p>No completed tickets yet</p>
                                        </div>
                                    ) : (
                                        <div style={{ display: 'grid', gap: '16px' }}>
                                            {completedTickets.map(ticket => (
                                                <div key={ticket.id} style={{
                                                    padding: '20px',
                                                    background: 'rgba(125, 211, 192, 0.04)',
                                                    borderRadius: '12px',
                                                    border: '1px solid var(--border-color)',
                                                    transition: 'all 0.2s',
                                                    cursor: 'pointer'
                                                }}
                                                onMouseEnter={(e) => e.currentTarget.style.background = 'rgba(125, 211, 192, 0.08)'}
                                                onMouseLeave={(e) => e.currentTarget.style.background = 'rgba(125, 211, 192, 0.04)'}
                                                onClick={() => { setViewingTicket(ticket); setShowTicketDetail(true); }}>
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '12px' }}>
                                                        <div style={{ flex: 1 }}>
                                                            <div style={{ display: 'flex', gap: '12px', alignItems: 'center', marginBottom: '8px' }}>
                                                                <h3 style={{ fontSize: '18px', fontWeight: 700, margin: 0 }}>{ticket.client}</h3>
                                                                <span className={`badge badge-${ticket.urgency}`}>{ticket.urgency}</span>
                                                            </div>
                                                            <p style={{ margin: 0, color: 'var(--text-secondary)', fontSize: '14px' }}>{ticket.task}</p>
                                                        </div>
                                                        <div style={{ display: 'flex', gap: '8px' }}>
                                                            <button 
                                                                className="btn btn-sm btn-warning" 
                                                                onClick={(e) => { e.stopPropagation(); archiveTicket(ticket, true); }}
                                                            >
                                                                <Icon name="archive" size={16} />
                                                            </button>
                                                            <button 
                                                                className="btn btn-sm btn-danger" 
                                                                onClick={(e) => { 
                                                                    e.stopPropagation(); 
                                                                    if (confirm('Move to recycle bin?')) {
                                                                        setRecycleBin(prev => [...prev, { ...ticket, type: 'ticket', deletedDate: new Date().toISOString().split('T')[0] }]);
                                                                        setCompletedTickets(prev => prev.filter(t => t.id !== ticket.id));
                                                                    }
                                                                }}
                                                            >
                                                                <Icon name="trash" size={16} />
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div style={{ display: 'flex', gap: '20px', fontSize: '13px', color: 'var(--text-secondary)' }}>
                                                        <span>Completed: {ticket.completedDate}</span>
                                                        <span>Assigned: {getStaffName(ticket.assignedTo)}</span>
                                                        <span style={{ color: 'var(--mint-500)', fontWeight: 600 }}>Click to view details</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'archived-tickets' && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <h1 className="page-title">Archived Tickets</h1>
                                    <p className="page-subtitle">Long-term storage</p>
                                </div>
                                
                                <div className="glass-card">
                                    {archivedTickets.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon"><Icon name="archive" size={48} /></div>
                                            <p>No archived tickets</p>
                                        </div>
                                    ) : (
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Client</th>
                                                    <th>Task</th>
                                                    <th>Archived Date</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {archivedTickets.map(ticket => (
                                                    <tr key={ticket.id}>
                                                        <td style={{ fontWeight: 600 }}>{ticket.client}</td>
                                                        <td>{ticket.task}</td>
                                                        <td>{ticket.archivedDate}</td>
                                                        <td>
                                                            <span className={`badge ${ticket.completedDate ? 'badge-low' : 'badge-medium'}`}>
                                                                {ticket.completedDate ? 'Completed' : 'Archived'}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <div style={{ display: 'flex', gap: '8px' }}>
                                                                <button className="btn btn-sm btn-secondary" onClick={() => { setViewingTicket(ticket); setShowTicketDetail(true); }}>
                                                                    <Icon name="search" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-primary" onClick={() => unarchiveTicket(ticket)}>
                                                                    <Icon name="archive" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-danger" onClick={() => {
                                                                    if (confirm('Move to recycle bin?')) {
                                                                        setRecycleBin(prev => [...prev, { ...ticket, type: 'ticket', deletedDate: new Date().toISOString().split('T')[0] }]);
                                                                        setArchivedTickets(prev => prev.filter(t => t.id !== ticket.id));
                                                                    }
                                                                }}>
                                                                    <Icon name="trash" size={16} />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'invoices' && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <div>
                                        <h1 className="page-title">Invoices</h1>
                                        <p className="page-subtitle">Track payments and billing</p>
                                    </div>
                                    <button className="btn btn-primary" onClick={() => setShowNewInvoice(true)}>
                                        <Icon name="plus" />
                                        New Invoice
                                    </button>
                                </div>
                                
                                {selectedInvoices.length > 0 && (
                                    <div className="bulk-actions">
                                        <span style={{ fontWeight: 600 }}>{selectedInvoices.length} selected</span>
                                        <button className="btn btn-sm btn-warning" onClick={bulkArchiveInvoices}>
                                            <Icon name="archive" size={16} />
                                            Archive Selected
                                        </button>
                                        <button className="btn btn-sm btn-danger" onClick={bulkDeleteInvoices}>
                                            <Icon name="trash" size={16} />
                                            Delete Selected
                                        </button>
                                    </div>
                                )}
                                
                                <div className="glass-card">
                                    {invoices.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon"><Icon name="invoice" size={48} /></div>
                                            <p>No invoices yet</p>
                                            <button className="btn btn-primary" onClick={() => setShowNewInvoice(true)} style={{ marginTop: '16px' }}>
                                                <Icon name="plus" />
                                                Create First Invoice
                                            </button>
                                        </div>
                                    ) : (
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th style={{ width: '40px' }}>
                                                        <input 
                                                            type="checkbox"
                                                            checked={selectedInvoices.length === invoices.length && invoices.length > 0}
                                                            onChange={(e) => {
                                                                if (e.target.checked) {
                                                                    setSelectedInvoices(invoices.map(inv => inv.id));
                                                                } else {
                                                                    setSelectedInvoices([]);
                                                                }
                                                            }}
                                                        />
                                                    </th>
                                                    <th>Client</th>
                                                    <th>Amount</th>
                                                    <th>Payment Terms</th>
                                                    <th>In QB</th>
                                                    <th>Paid Date</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {filteredInvoices.map(invoice => (
                                                    <tr key={invoice.id}>
                                                        <td>
                                                            <input 
                                                                type="checkbox"
                                                                checked={selectedInvoices.includes(invoice.id)}
                                                                onChange={() => toggleInvoiceSelection(invoice.id)}
                                                            />
                                                        </td>
                                                        <td style={{ fontWeight: 600 }}>{invoice.client}</td>
                                                        <td style={{ fontSize: '16px', fontWeight: 700, color: 'var(--peach-500)' }}>
                                                            £{parseFloat(invoice.totalAmount || 0).toFixed(2)}
                                                        </td>
                                                        <td>
                                                            <span className="badge" style={{ background: 'rgba(125, 211, 192, 0.2)', color: 'var(--mint-500)' }}>
                                                                {invoice.paymentTerms === 'now' ? 'Pay Now' : 'End of Month'}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span className={`badge ${invoice.inQuickBooks === 'yes' ? 'badge-low' : 'badge-medium'}`}>
                                                                {invoice.inQuickBooks === 'yes' ? 'Yes' : 'No'}
                                                            </span>
                                                        </td>
                                                        <td>{invoice.paid ? invoice.paidDate : '-'}</td>
                                                        <td>
                                                            <div style={{ display: 'flex', gap: '8px' }}>
                                                                <button className="btn btn-sm btn-secondary" onClick={() => { setViewingInvoice(invoice); setShowInvoiceDetail(true); }}>
                                                                    <Icon name="search" size={16} />
                                                                </button>
                                                                <button 
                                                                    className={`btn btn-sm ${invoice.paid ? 'btn-secondary' : 'btn-primary'}`}
                                                                    onClick={() => togglePaid(invoice.id)}
                                                                >
                                                                    <Icon name={invoice.paid ? 'x' : 'check'} size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-warning" onClick={() => archiveInvoice(invoice)}>
                                                                    <Icon name="archive" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-danger" onClick={() => deleteInvoice(invoice)}>
                                                                    <Icon name="trash" size={16} />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'archived-invoices' && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <h1 className="page-title">Archived Invoices</h1>
                                    <p className="page-subtitle">Long-term storage</p>
                                </div>
                                
                                <div className="glass-card">
                                    {archivedInvoices.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon"><Icon name="archive" size={48} /></div>
                                            <p>No archived invoices</p>
                                        </div>
                                    ) : (
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Client</th>
                                                    <th>Amount</th>
                                                    <th>Archived Date</th>
                                                    <th>Paid</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {archivedInvoices.map(invoice => (
                                                    <tr key={invoice.id}>
                                                        <td style={{ fontWeight: 600 }}>{invoice.client}</td>
                                                        <td style={{ fontSize: '16px', fontWeight: 700 }}>
                                                            £{parseFloat(invoice.totalAmount || 0).toFixed(2)}
                                                        </td>
                                                        <td>{invoice.archivedDate}</td>
                                                        <td>
                                                            <span className={`badge ${invoice.paid ? 'badge-low' : 'badge-medium'}`}>
                                                                {invoice.paid ? 'Yes' : 'No'}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <div style={{ display: 'flex', gap: '8px' }}>
                                                                <button className="btn btn-sm btn-secondary" onClick={() => { setViewingInvoice(invoice); setShowInvoiceDetail(true); }}>
                                                                    <Icon name="search" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-primary" onClick={() => unarchiveInvoice(invoice)}>
                                                                    <Icon name="archive" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-danger" onClick={() => {
                                                                    if (confirm('Move to recycle bin?')) {
                                                                        setRecycleBin(prev => [...prev, { ...invoice, type: 'invoice', deletedDate: new Date().toISOString().split('T')[0] }]);
                                                                        setArchivedInvoices(prev => prev.filter(inv => inv.id !== invoice.id));
                                                                    }
                                                                }}>
                                                                    <Icon name="trash" size={16} />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'paid' && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <h1 className="page-title">Paid Invoices</h1>
                                    <p className="page-subtitle">Successfully paid invoices</p>
                                </div>
                                
                                <div className="glass-card">
                                    {paidInvoices.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon"><Icon name="check" size={48} /></div>
                                            <p>No paid invoices yet</p>
                                        </div>
                                    ) : (
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Client</th>
                                                    <th>Amount</th>
                                                    <th>Paid Date</th>
                                                    <th>Contact</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {paidInvoices.map(invoice => (
                                                    <tr key={invoice.id}>
                                                        <td style={{ fontWeight: 600 }}>{invoice.client}</td>
                                                        <td style={{ fontSize: '16px', fontWeight: 700 }}>
                                                            £{parseFloat(invoice.totalAmount || 0).toFixed(2)}
                                                        </td>
                                                        <td>{invoice.paidDate}</td>
                                                        <td>
                                                            <div style={{ fontSize: '12px' }}>
                                                                <div>{invoice.contactName}</div>
                                                                <div style={{ color: 'var(--text-secondary)' }}>{invoice.contactPhone}</div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div style={{ display: 'flex', gap: '8px' }}>
                                                                <button className="btn btn-sm btn-secondary" onClick={() => { setViewingInvoice(invoice); setShowInvoiceDetail(true); }}>
                                                                    <Icon name="search" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-warning" onClick={() => archiveInvoice(invoice)}>
                                                                    <Icon name="archive" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-danger" onClick={() => deleteInvoice(invoice)}>
                                                                    <Icon name="trash" size={16} />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'admin' && (currentUser.role === 'owner' || currentUser.role === 'admin') && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <div>
                                        <h1 className="page-title">Admin Panel</h1>
                                        <p className="page-subtitle">Manage staff members</p>
                                    </div>
                                    <button className="btn btn-primary" onClick={() => setShowAddStaff(true)}>
                                        <Icon name="plus" />
                                        Add Staff
                                    </button>
                                </div>
                                
                                <div className="glass-card">
                                    <div style={{ display: 'grid', gap: '16px' }}>
                                        {users.map(user => (
                                            <div key={user.id} style={{ 
                                                display: 'flex', 
                                                alignItems: 'center', 
                                                justifyContent: 'space-between', 
                                                padding: '16px', 
                                                borderRadius: '12px', 
                                                background: 'rgba(125, 211, 192, 0.05)'
                                            }}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                                                    <div className="user-avatar">
                                                        {user.firstName?.[0] || user.name[0]}
                                                    </div>
                                                    <div>
                                                        <div style={{ fontWeight: 600, fontSize: '15px' }}>{user.name}</div>
                                                        <div style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>{user.username}</div>
                                                    </div>
                                                </div>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                                    <span className="badge" style={{
                                                        background: user.role === 'owner' ? 
                                                            'linear-gradient(135deg, #ff8b94 0%, #ff6b77 100%)' :
                                                            user.role === 'admin' ?
                                                            'linear-gradient(135deg, #6eb5ff 0%, #5a8ba0 100%)' :
                                                            'linear-gradient(135deg, #7dd3c0 0%, #5a8ba0 100%)',
                                                        color: 'white'
                                                    }}>
                                                        {user.role}
                                                    </span>
                                                    <button className="btn btn-sm btn-secondary" onClick={() => openEditUser(user)}>
                                                        <Icon name="edit" size={16} />
                                                    </button>
                                                    {currentUser.role === 'owner' && user.role !== 'owner' && (
                                                        <button className="btn btn-sm btn-danger" onClick={() => removeStaff(user.id)}>
                                                            <Icon name="trash" size={16} />
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'my-tickets' && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <h1 className="page-title">My Tickets</h1>
                                    <p className="page-subtitle">Tickets assigned to you</p>
                                </div>
                                
                                <div className="glass-card">
                                    {myTickets.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon"><Icon name="user" size={48} /></div>
                                            <p>No tickets assigned to you</p>
                                        </div>
                                    ) : (
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Client</th>
                                                    <th>Task</th>
                                                    <th>Deadline</th>
                                                    <th>Urgency</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {myTickets.map(ticket => (
                                                    <tr key={ticket.id}>
                                                        <td style={{ fontWeight: 600 }}>{ticket.client}</td>
                                                        <td>{ticket.task}</td>
                                                        <td>{ticket.deadline}</td>
                                                        <td>
                                                            <span className={`badge badge-${ticket.urgency}`}>
                                                                {ticket.urgency}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <div style={{ display: 'flex', gap: '8px' }}>
                                                                <button className="btn btn-sm btn-secondary" onClick={() => { setViewingTicket(ticket); setShowTicketDetail(true); }}>
                                                                    <Icon name="search" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-secondary" onClick={() => openEditTicket(ticket)}>
                                                                    <Icon name="edit" size={16} />
                                                                </button>
                                                                <button className="btn btn-sm btn-primary" onClick={() => { setSelectedTicket(ticket); setShowResolution(true); }}>
                                                                    <Icon name="check" size={16} />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {currentView === 'recycle' && (
                            <div className="content-wrapper">
                                <div className="page-header">
                                    <div>
                                        <h1 className="page-title">Recycle Bin</h1>
                                        <p className="page-subtitle">Deleted items</p>
                                    </div>
                                    {recycleBin.length > 0 && (
                                        <button 
                                            className="btn btn-danger" 
                                            onClick={() => {
                                                if (confirm('Permanently delete ALL items? This cannot be undone!')) {
                                                    setRecycleBin([]);
                                                }
                                            }}
                                        >
                                            <Icon name="trash" />
                                            Empty Recycle Bin
                                        </button>
                                    )}
                                </div>
                                
                                <div className="glass-card">
                                    {recycleBin.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon"><Icon name="trash" size={48} /></div>
                                            <p>Recycle bin is empty</p>
                                        </div>
                                    ) : (
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Type</th>
                                                    <th>Name</th>
                                                    <th>Deleted Date</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {recycleBin.map((item, idx) => (
                                                    <tr key={idx}>
                                                        <td>
                                                            <span className={`badge ${item.type === 'ticket' ? 'badge-low' : 'badge-medium'}`}>
                                                                {item.type}
                                                            </span>
                                                        </td>
                                                        <td style={{ fontWeight: 600 }}>{item.client}</td>
                                                        <td>{item.deletedDate}</td>
                                                        <td>
                                                            <button 
                                                                className="btn btn-sm btn-danger" 
                                                                onClick={() => {
                                                                    if (confirm('Permanently delete this item? This cannot be undone!')) {
                                                                        setRecycleBin(prev => prev.filter((_, i) => i !== idx));
                                                                    }
                                                                }}
                                                            >
                                                                <Icon name="x" size={16} /> Delete Forever
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* Modals remain the same but I'll add the edit user modal */}
                    
                    {showEditUser && editingUser && (
                        <div className="modal-overlay" onClick={() => setShowEditUser(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2 className="modal-title">Edit User: {editingUser.name}</h2>
                                    <button onClick={() => setShowEditUser(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                                        <Icon name="x" size={24} />
                                    </button>
                                </div>
                                
                                <div className="form-grid">
                                    <div>
                                        <label className="form-label">Username</label>
                                        <input 
                                            type="text" 
                                            value={editUserForm.username} 
                                            onChange={(e) => setEditUserForm({ ...editUserForm, username: e.target.value })} 
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">New Password (leave blank to keep current)</label>
                                        <input 
                                            type="password" 
                                            value={editUserForm.password} 
                                            onChange={(e) => setEditUserForm({ ...editUserForm, password: e.target.value })} 
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">Confirm New Password</label>
                                        <input 
                                            type="password" 
                                            value={editUserForm.confirmPassword} 
                                            onChange={(e) => setEditUserForm({ ...editUserForm, confirmPassword: e.target.value })} 
                                        />
                                    </div>
                                </div>
                                
                                <div style={{ display: 'flex', gap: '12px', marginTop: '24px' }}>
                                    <button className="btn btn-primary" onClick={updateUser} style={{ flex: 1, justifyContent: 'center' }}>
                                        Update User
                                    </button>
                                    <button className="btn btn-secondary" onClick={() => setShowEditUser(false)}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showNewTicket && (
                        <div className="modal-overlay" onClick={() => setShowNewTicket(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2 className="modal-title">New Ticket</h2>
                                    <button onClick={() => setShowNewTicket(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                                        <Icon name="x" size={24} />
                                    </button>
                                </div>
                                
                                <div className="form-grid">
                                    <div>
                                        <label className="form-label">Client Name *</label>
                                        <input type="text" value={newTicket.client} onChange={(e) => setNewTicket({ ...newTicket, client: e.target.value })} required />
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">Task Description *</label>
                                        <input type="text" value={newTicket.task} onChange={(e) => setNewTicket({ ...newTicket, task: e.target.value })} required />
                                    </div>
                                    
                                    <div className="form-row">
                                        <div>
                                            <label className="form-label">Deadline *</label>
                                            <input type="date" value={newTicket.deadline} onChange={(e) => setNewTicket({ ...newTicket, deadline: e.target.value })} required />
                                        </div>
                                        
                                        <div>
                                            <label className="form-label">Location</label>
                                            <input type="text" value={newTicket.location} onChange={(e) => setNewTicket({ ...newTicket, location: e.target.value })} />
                                        </div>
                                    </div>
                                    
                                    <div className="form-row">
                                        <div>
                                            <label className="form-label">Urgency</label>
                                            <select value={newTicket.urgency} onChange={(e) => setNewTicket({ ...newTicket, urgency: e.target.value })}>
                                                <option value="low">Low</option>
                                                <option value="medium">Medium</option>
                                                <option value="high">High</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="form-label">Assign To</label>
                                            <select value={newTicket.assignedTo} onChange={(e) => setNewTicket({ ...newTicket, assignedTo: e.target.value })}>
                                                <option value="">Unassigned</option>
                                                {users.filter(u => u.role !== 'owner').map(user => (
                                                    <option key={user.id} value={user.username}>{user.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">Description</label>
                                        <textarea rows="4" value={newTicket.description} onChange={(e) => setNewTicket({ ...newTicket, description: e.target.value })} />
                                    </div>
                                </div>
                                
                                <div style={{ display: 'flex', gap: '12px', marginTop: '24px' }}>
                                    <button className="btn btn-primary" onClick={createTicket} style={{ flex: 1, justifyContent: 'center' }}>
                                        Create Ticket
                                    </button>
                                    <button className="btn btn-secondary" onClick={() => setShowNewTicket(false)}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showNewInvoice && (
                        <div className="modal-overlay" onClick={() => setShowNewInvoice(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2 className="modal-title">New Invoice</h2>
                                    <button onClick={() => setShowNewInvoice(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                                        <Icon name="x" size={24} />
                                    </button>
                                </div>
                                
                                <div className="form-grid">
                                    <div>
                                        <label className="form-label">Client Name *</label>
                                        <input type="text" value={newInvoice.client} onChange={(e) => setNewInvoice({ ...newInvoice, client: e.target.value })} required />
                                    </div>
                                    
                                    <div className="form-row">
                                        <div>
                                            <label className="form-label">Payment Terms</label>
                                            <select value={newInvoice.paymentTerms} onChange={(e) => setNewInvoice({ ...newInvoice, paymentTerms: e.target.value })}>
                                                <option value="now">Pay Now</option>
                                                <option value="end_of_month">End of Month</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="form-label">In QuickBooks?</label>
                                            <select value={newInvoice.inQuickBooks} onChange={(e) => setNewInvoice({ ...newInvoice, inQuickBooks: e.target.value })}>
                                                <option value="no">No</option>
                                                <option value="yes">Yes</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">Invoice Sections</label>
                                        <div className="invoice-sections">
                                            {invoiceSections.map((section, idx) => (
                                                <div key={idx} style={{ marginBottom: '16px', padding: '16px', background: 'rgba(125, 211, 192, 0.04)', borderRadius: '12px', border: '1px solid var(--border-color)' }}>
                                                    <div className="section-item" style={{ marginBottom: '12px' }}>
                                                        <input
                                                            type="text"
                                                            placeholder="Description (e.g. Server Setup, RAM Upgrade)"
                                                            value={section.description}
                                                            onChange={(e) => updateInvoiceSection(idx, 'description', e.target.value)}
                                                            style={{ flex: 2 }}
                                                        />
                                                        <select
                                                            value={section.type}
                                                            onChange={(e) => updateInvoiceSection(idx, 'type', e.target.value)}
                                                            style={{ width: '140px' }}
                                                        >
                                                            <option value="hourly">Hourly Rate</option>
                                                            <option value="fixed">Fixed Charge</option>
                                                        </select>
                                                        {invoiceSections.length > 1 && (
                                                            <button 
                                                                className="btn btn-sm btn-danger" 
                                                                onClick={() => removeInvoiceSection(idx)}
                                                                type="button"
                                                            >
                                                                <Icon name="x" size={14} />
                                                            </button>
                                                        )}
                                                    </div>
                                                    
                                                    {section.type === 'hourly' ? (
                                                        <div className="section-item">
                                                            <input
                                                                type="number"
                                                                step="0.01"
                                                                placeholder="Rate (£/hr)"
                                                                value={section.rate}
                                                                onChange={(e) => updateInvoiceSection(idx, 'rate', e.target.value)}
                                                                style={{ width: '110px' }}
                                                            />
                                                            <span style={{ padding: '0 8px', color: 'var(--text-secondary)', fontWeight: 600 }}>×</span>
                                                            <input
                                                                type="number"
                                                                step="0.01"
                                                                placeholder="Hours"
                                                                value={section.hours}
                                                                onChange={(e) => updateInvoiceSection(idx, 'hours', e.target.value)}
                                                                style={{ width: '100px' }}
                                                            />
                                                            <span style={{ padding: '0 8px', color: 'var(--text-secondary)', fontWeight: 600 }}>=</span>
                                                            <span style={{ fontWeight: 700, color: 'var(--peach-500)', minWidth: '100px', fontSize: '16px' }}>
                                                                £{((parseFloat(section.rate) || 0) * (parseFloat(section.hours) || 0)).toFixed(2)}
                                                            </span>
                                                        </div>
                                                    ) : (
                                                        <div className="section-item">
                                                            <input
                                                                type="number"
                                                                step="0.01"
                                                                placeholder="Amount (£)"
                                                                value={section.amount}
                                                                onChange={(e) => updateInvoiceSection(idx, 'amount', e.target.value)}
                                                                style={{ width: '150px' }}
                                                            />
                                                            <span style={{ padding: '0 8px', color: 'var(--text-secondary)', fontWeight: 600 }}>=</span>
                                                            <span style={{ fontWeight: 700, color: 'var(--peach-500)', minWidth: '100px', fontSize: '16px' }}>
                                                                £{(parseFloat(section.amount) || 0).toFixed(2)}
                                                            </span>
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                            <button className="btn btn-sm btn-secondary" onClick={addInvoiceSection} type="button" style={{ marginTop: '8px' }}>
                                                <Icon name="plus" size={14} />
                                                Add Section
                                            </button>
                                            <div className="section-total">
                                                Total: £{calculateInvoiceTotal().toFixed(2)}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style={{ padding: '16px', borderRadius: '12px', background: 'rgba(125, 211, 192, 0.08)' }}>
                                        <h4 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '12px' }}>Contact Information</h4>
                                        <div className="form-grid">
                                            <input 
                                                type="text" 
                                                placeholder="Contact Name" 
                                                value={newInvoice.contactName} 
                                                onChange={(e) => setNewInvoice({ ...newInvoice, contactName: e.target.value })} 
                                            />
                                            <input 
                                                type="email" 
                                                placeholder="Contact Email" 
                                                value={newInvoice.contactEmail} 
                                                onChange={(e) => setNewInvoice({ ...newInvoice, contactEmail: e.target.value })} 
                                            />
                                            <input 
                                                type="tel" 
                                                placeholder="Contact Phone" 
                                                value={newInvoice.contactPhone} 
                                                onChange={(e) => {
                                                    const value = e.target.value.replace(/\D/g, '');
                                                    setNewInvoice({ ...newInvoice, contactPhone: value });
                                                }}
                                            />
                                        </div>
                                    </div>
                                </div>
                                
                                <div style={{ display: 'flex', gap: '12px', marginTop: '24px' }}>
                                    <button className="btn btn-primary" onClick={createInvoice} style={{ flex: 1, justifyContent: 'center' }}>
                                        Create Invoice
                                    </button>
                                    <button className="btn btn-secondary" onClick={() => setShowNewInvoice(false)}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showResolution && selectedTicket && (
                        <div className="modal-overlay" onClick={() => setShowResolution(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2 className="modal-title">Complete Ticket</h2>
                                    <button onClick={() => setShowResolution(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                                        <Icon name="x" size={24} />
                                    </button>
                                </div>
                                
                                <p style={{ marginBottom: '16px', color: 'var(--text-secondary)' }}>
                                    <strong>{selectedTicket.client}</strong> - {selectedTicket.task}
                                </p>
                                
                                <div>
                                    <label className="form-label">Resolution *</label>
                                    <textarea 
                                        rows="6" 
                                        placeholder="How was this issue resolved?"
                                        value={resolution} 
                                        onChange={(e) => setResolution(e.target.value)}
                                        required
                                    />
                                </div>
                                
                                <div style={{ display: 'flex', gap: '12px', marginTop: '24px' }}>
                                    <button 
                                        className="btn btn-primary" 
                                        onClick={completeTicket}
                                        disabled={!resolution.trim()}
                                        style={{ 
                                            flex: 1, 
                                            justifyContent: 'center',
                                            opacity: resolution.trim() ? 1 : 0.5,
                                            cursor: resolution.trim() ? 'pointer' : 'not-allowed'
                                        }}
                                    >
                                        Complete Ticket
                                    </button>
                                    <button className="btn btn-secondary" onClick={() => { setShowResolution(false); setResolution(''); }}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showSettings && (
                        <div className="modal-overlay" onClick={() => setShowSettings(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2 className="modal-title">Settings</h2>
                                    <button onClick={() => setShowSettings(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                                        <Icon name="x" size={24} />
                                    </button>
                                </div>
                                
                                <div className="form-grid">
                                    <div>
                                        <label className="form-label">Current Password *</label>
                                        <input 
                                            type="password" 
                                            value={settingsForm.currentPassword} 
                                            onChange={(e) => setSettingsForm({ ...settingsForm, currentPassword: e.target.value })} 
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">New Username</label>
                                        <input 
                                            type="text" 
                                            placeholder="Leave blank to keep current"
                                            value={settingsForm.newUsername} 
                                            onChange={(e) => setSettingsForm({ ...settingsForm, newUsername: e.target.value })} 
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">New Password</label>
                                        <input 
                                            type="password" 
                                            placeholder="Leave blank to keep current"
                                            value={settingsForm.newPassword} 
                                            onChange={(e) => setSettingsForm({ ...settingsForm, newPassword: e.target.value })} 
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">Confirm New Password</label>
                                        <input 
                                            type="password" 
                                            value={settingsForm.confirmPassword} 
                                            onChange={(e) => setSettingsForm({ ...settingsForm, confirmPassword: e.target.value })} 
                                        />
                                    </div>
                                </div>
                                
                                <div style={{ display: 'flex', gap: '12px', marginTop: '24px' }}>
                                    <button className="btn btn-primary" onClick={updateSettings} style={{ flex: 1, justifyContent: 'center' }}>
                                        Update Settings
                                    </button>
                                    <button className="btn btn-secondary" onClick={() => setShowSettings(false)}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showAddStaff && (
                        <div className="modal-overlay" onClick={() => setShowAddStaff(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2 className="modal-title">Add Staff Member</h2>
                                    <button onClick={() => setShowAddStaff(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                                        <Icon name="x" size={24} />
                                    </button>
                                </div>
                                
                                <div className="form-grid">
                                    <div className="form-row">
                                        <div>
                                            <label className="form-label">First Name *</label>
                                            <input type="text" value={newStaff.firstName} onChange={(e) => setNewStaff({ ...newStaff, firstName: e.target.value })} />
                                        </div>
                                        <div>
                                            <label className="form-label">Last Name *</label>
                                            <input type="text" value={newStaff.lastName} onChange={(e) => setNewStaff({ ...newStaff, lastName: e.target.value })} />
                                        </div>
                                    </div>
                                    
                                    <div className="form-row">
                                        <div>
                                            <label className="form-label">Username *</label>
                                            <input type="text" value={newStaff.username} onChange={(e) => setNewStaff({ ...newStaff, username: e.target.value })} />
                                        </div>
                                        <div>
                                            <label className="form-label">Password *</label>
                                            <input type="password" value={newStaff.password} onChange={(e) => setNewStaff({ ...newStaff, password: e.target.value })} />
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">Role</label>
                                        <select value={newStaff.role} onChange={(e) => setNewStaff({ ...newStaff, role: e.target.value })}>
                                            <option value="staff">Staff</option>
                                            <option value="admin">Admin</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style={{ display: 'flex', gap: '12px', marginTop: '24px' }}>
                                    <button className="btn btn-primary" onClick={addStaff} style={{ flex: 1, justifyContent: 'center' }}>
                                        Add Staff Member
                                    </button>
                                    <button className="btn btn-secondary" onClick={() => setShowAddStaff(false)}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showEditTicket && editingTicket && (
                        <div className="modal-overlay" onClick={() => setShowEditTicket(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2 className="modal-title">Edit Ticket</h2>
                                    <button onClick={() => setShowEditTicket(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                                        <Icon name="x" size={24} />
                                    </button>
                                </div>
                                
                                <div className="form-grid">
                                    <div>
                                        <label className="form-label">Client Name *</label>
                                        <input type="text" value={editTicketForm.client} onChange={(e) => setEditTicketForm({ ...editTicketForm, client: e.target.value })} required />
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">Task Description *</label>
                                        <input type="text" value={editTicketForm.task} onChange={(e) => setEditTicketForm({ ...editTicketForm, task: e.target.value })} required />
                                    </div>
                                    
                                    <div className="form-row">
                                        <div>
                                            <label className="form-label">Deadline *</label>
                                            <input type="date" value={editTicketForm.deadline} onChange={(e) => setEditTicketForm({ ...editTicketForm, deadline: e.target.value })} required />
                                        </div>
                                        
                                        <div>
                                            <label className="form-label">Location</label>
                                            <input type="text" value={editTicketForm.location} onChange={(e) => setEditTicketForm({ ...editTicketForm, location: e.target.value })} />
                                        </div>
                                    </div>
                                    
                                    <div className="form-row">
                                        <div>
                                            <label className="form-label">Urgency</label>
                                            <select value={editTicketForm.urgency} onChange={(e) => setEditTicketForm({ ...editTicketForm, urgency: e.target.value })}>
                                                <option value="low">Low</option>
                                                <option value="medium">Medium</option>
                                                <option value="high">High</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="form-label">Assign To</label>
                                            <select value={editTicketForm.assignedTo} onChange={(e) => setEditTicketForm({ ...editTicketForm, assignedTo: e.target.value })}>
                                                <option value="">Unassigned</option>
                                                {users.filter(u => u.role !== 'owner').map(user => (
                                                    <option key={user.id} value={user.username}>{user.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="form-label">Description</label>
                                        <textarea rows="4" value={editTicketForm.description} onChange={(e) => setEditTicketForm({ ...editTicketForm, description: e.target.value })} />
                                    </div>
                                </div>
                                
                                <div style={{ display: 'flex', gap: '12px', marginTop: '24px' }}>
                                    <button className="btn btn-primary" onClick={updateTicket} style={{ flex: 1, justifyContent: 'center' }}>
                                        Update Ticket
                                    </button>
                                    <button className="btn btn-secondary" onClick={() => setShowEditTicket(false)}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showTicketDetail && viewingTicket && (
                        <div className="modal-overlay" onClick={() => setShowTicketDetail(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '700px' }}>
                                <div className="modal-header">
                                    <h2 className="modal-title">Ticket Details</h2>
                                    <button onClick={() => setShowTicketDetail(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                                        <Icon name="x" size={24} />
                                    </button>
                                </div>
                                
                                <div style={{ marginBottom: '24px' }}>
                                    <div style={{ display: 'flex', gap: '12px', alignItems: 'center', marginBottom: '16px' }}>
                                        <h3 style={{ fontSize: '24px', fontWeight: 700, margin: 0 }}>{viewingTicket.client}</h3>
                                        <span className={`badge badge-${viewingTicket.urgency}`}>{viewingTicket.urgency}</span>
                                        {viewingTicket.completedDate && (
                                            <span className="badge badge-low">Completed</span>
                                        )}
                                    </div>
                                    
                                    <div style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '20px' }}>
                                        {viewingTicket.task}
                                    </div>
                                    
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '20px', marginBottom: '20px' }}>
                                        <div>
                                            <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--text-secondary)', marginBottom: '6px', letterSpacing: '0.5px' }}>
                                                Deadline
                                            </div>
                                            <div style={{ fontSize: '15px', fontWeight: 600 }}>{viewingTicket.deadline}</div>
                                        </div>
                                        
                                        <div>
                                            <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--text-secondary)', marginBottom: '6px', letterSpacing: '0.5px' }}>
                                                Assigned To
                                            </div>
                                            <div style={{ fontSize: '15px', fontWeight: 600 }}>{getStaffName(viewingTicket.assignedTo)}</div>
                                        </div>
                                        
                                        <div>
                                            <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--text-secondary)', marginBottom: '6px', letterSpacing: '0.5px' }}>
                                                Location
                                            </div>
                                            <div style={{ fontSize: '15px', fontWeight: 600 }}>{viewingTicket.location || 'N/A'}</div>
                                        </div>
                                        
                                        <div>
                                            <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--text-secondary)', marginBottom: '6px', letterSpacing: '0.5px' }}>
                                                Created
                                            </div>
                                            <div style={{ fontSize: '15px', fontWeight: 600 }}>{viewingTicket.created}</div>
                                        </div>
                                    </div>
                                    
                                    {viewingTicket.description && (
                                        <div style={{ marginBottom: '20px' }}>
                                            <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--text-secondary)', marginBottom: '10px', letterSpacing: '0.5px' }}>
                                                Description
                                            </div>
                                            <div style={{ 
                                                padding: '16px', 
                                                background: 'rgba(125, 211, 192, 0.05)', 
                                                borderRadius: '12px',
                                                fontSize: '14px',
                                                lineHeight: '1.7',
                                                border: '1px solid var(--border-color)'
                                            }}>
                                                {viewingTicket.description}
                                            </div>
                                        </div>
                                    )}
                                    
                                    {viewingTicket.resolution && (
                                        <div>
                                            <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--mint-500)', marginBottom: '10px', letterSpacing: '0.5px' }}>
                                                ✓ Resolution
                                            </div>
                                            <div style={{ 
                                                padding: '16px', 
                                                background: 'rgba(125, 211, 192, 0.1)', 
                                                borderRadius: '12px',
                                                fontSize: '14px',
                                                lineHeight: '1.7',
                                                borderLeft: '4px solid var(--mint-500)'
                                            }}>
                                                {viewingTicket.resolution}
                                            </div>
                                            {viewingTicket.completedDate && (
                                                <div style={{ fontSize: '12px', color: 'var(--text-secondary)', marginTop: '8px' }}>
                                                    Completed on {viewingTicket.completedDate}
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                                
                                <div style={{ display: 'flex', justifyContent: 'flex-end' }}>
                                    <button className="btn btn-secondary" onClick={() => setShowTicketDetail(false)}>
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showInvoiceDetail && viewingInvoice && (
                        <div className="modal-overlay" onClick={() => setShowInvoiceDetail(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '700px' }}>
                                <div className="modal-header">
                                    <h2 className="modal-title">Invoice Details</h2>
                                    <button onClick={() => setShowInvoiceDetail(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                                        <Icon name="x" size={24} />
                                    </button>
                                </div>
                                
                                <div style={{ marginBottom: '24px' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                                        <div>
                                            <h3 style={{ fontSize: '24px', fontWeight: 700, margin: '0 0 8px 0' }}>{viewingInvoice.client}</h3>
                                            <div style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>
                                                Invoice Date: {viewingInvoice.date}
                                            </div>
                                        </div>
                                        <div>
                                            {viewingInvoice.paid ? (
                                                <span className="badge badge-low" style={{ fontSize: '14px', padding: '8px 16px' }}>PAID</span>
                                            ) : (
                                                <span className="badge badge-medium" style={{ fontSize: '14px', padding: '8px 16px' }}>UNPAID</span>
                                            )}
                                        </div>
                                    </div>
                                    
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '20px', marginBottom: '24px' }}>
                                        <div>
                                            <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--text-secondary)', marginBottom: '6px', letterSpacing: '0.5px' }}>
                                                Payment Terms
                                            </div>
                                            <div style={{ fontSize: '15px', fontWeight: 600 }}>
                                                {viewingInvoice.paymentTerms === 'now' ? 'Pay Now' : 'End of Month'}
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--text-secondary)', marginBottom: '6px', letterSpacing: '0.5px' }}>
                                                In QuickBooks
                                            </div>
                                            <div style={{ fontSize: '15px', fontWeight: 600 }}>
                                                {viewingInvoice.inQuickBooks === 'yes' ? 'Yes' : 'No'}
                                            </div>
                                        </div>
                                        
                                        {viewingInvoice.paid && (
                                            <div>
                                                <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--text-secondary)', marginBottom: '6px', letterSpacing: '0.5px' }}>
                                                    Paid Date
                                                </div>
                                                <div style={{ fontSize: '15px', fontWeight: 600 }}>{viewingInvoice.paidDate}</div>
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div style={{ marginBottom: '20px' }}>
                                        <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--text-secondary)', marginBottom: '12px', letterSpacing: '0.5px' }}>
                                            Line Items
                                        </div>
                                        <div style={{ border: '1px solid var(--border-color)', borderRadius: '12px', overflow: 'hidden' }}>
                                            {viewingInvoice.sections && viewingInvoice.sections.map((section, idx) => {
                                                let amount = 0;
                                                let displayType = '';
                                                
                                                if (section.type === 'hourly' || (section.rate && section.hours)) {
                                                    amount = (parseFloat(section.rate) || 0) * (parseFloat(section.hours) || 0);
                                                    displayType = 'hourly';
                                                } else {
                                                    amount = parseFloat(section.amount) || 0;
                                                    displayType = 'fixed';
                                                }
                                                
                                                return (
                                                    <div key={idx} style={{ 
                                                        padding: '16px', 
                                                        display: 'flex', 
                                                        justifyContent: 'space-between',
                                                        alignItems: 'center',
                                                        background: idx % 2 === 0 ? 'rgba(125, 211, 192, 0.02)' : 'transparent',
                                                        borderBottom: idx < viewingInvoice.sections.length - 1 ? '1px solid var(--border-color)' : 'none'
                                                    }}>
                                                        <div style={{ flex: 1 }}>
                                                            <div style={{ fontWeight: 600, marginBottom: '4px' }}>{section.description}</div>
                                                            {displayType === 'hourly' && (
                                                                <div style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>
                                                                    Hourly Rate: £{parseFloat(section.rate).toFixed(2)}/hr × {parseFloat(section.hours).toFixed(1)}h
                                                                </div>
                                                            )}
                                                            {displayType === 'fixed' && (
                                                                <div style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>
                                                                    Fixed Charge
                                                                </div>
                                                            )}
                                                        </div>
                                                        <div style={{ textAlign: 'right' }}>
                                                            <div style={{ fontWeight: 700, fontSize: '16px', color: 'var(--peach-500)' }}>
                                                                £{amount.toFixed(2)}
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            <div style={{ 
                                                padding: '16px', 
                                                display: 'flex', 
                                                justifyContent: 'space-between',
                                                background: 'rgba(255, 180, 162, 0.1)',
                                                borderTop: '2px solid var(--peach-500)'
                                            }}>
                                                <span style={{ fontWeight: 700, fontSize: '16px' }}>Total</span>
                                                <span style={{ fontWeight: 700, fontSize: '20px', color: 'var(--peach-500)' }}>
                                                    £{parseFloat(viewingInvoice.totalAmount || 0).toFixed(2)}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {(viewingInvoice.contactName || viewingInvoice.contactEmail || viewingInvoice.contactPhone) && (
                                        <div style={{ 
                                            padding: '16px', 
                                            background: 'rgba(125, 211, 192, 0.05)', 
                                            borderRadius: '12px',
                                            border: '1px solid var(--border-color)'
                                        }}>
                                            <div style={{ fontSize: '11px', fontWeight: 700, textTransform: 'uppercase', color: 'var(--text-secondary)', marginBottom: '10px', letterSpacing: '0.5px' }}>
                                                Contact Information
                                            </div>
                                            {viewingInvoice.contactName && (
                                                <div style={{ marginBottom: '4px', fontSize: '14px' }}><strong>Name:</strong> {viewingInvoice.contactName}</div>
                                            )}
                                            {viewingInvoice.contactEmail && (
                                                <div style={{ marginBottom: '4px', fontSize: '14px' }}><strong>Email:</strong> {viewingInvoice.contactEmail}</div>
                                            )}
                                            {viewingInvoice.contactPhone && (
                                                <div style={{ fontSize: '14px' }}><strong>Phone:</strong> {viewingInvoice.contactPhone}</div>
                                            )}
                                        </div>
                                    )}
                                </div>
                                
                                <div style={{ display: 'flex', justifyContent: 'flex-end' }}>
                                    <button className="btn btn-secondary" onClick={() => setShowInvoiceDetail(false)}>
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
